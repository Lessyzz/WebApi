@model WebApi.Models.Product
@{
Layout = "~/Views/Shared/_Layout.cshtml";
}

<head>
    <title>@Model.Name</title>
</head>

<h5 class="mt-4 mb-3" style="cursor: pointer;">
    <a  class="link-body-emphasis" href="javascript: history.go(-1);">
        <i class="bi bi-arrow-left"></i>
        Geri
    </a>
</h5>
<div class="container">
    <div class="row shadow p-4 position-relative">
        @if (Model.Discount > 0)
        {
            <div class="discount-badge-overflowed">@Model.Discount% İndirim</div>
        }
        <div class="col-12 col-lg-6 text-center mb-4">
            @{
                var imageArray = Model.Images.Split(',');
            }

            <!-- Main large image -->
            <div class="mb-3">
                <img id="mainImage" class="img-fluid" src="@imageArray[0]"
                     style="max-width: min(500px, 100%); max-height: 500px;">
            </div>

            <!-- Thumbnail images row -->
            <div class="row g-2 justify-content-center">
                @for (int i = 0; i < imageArray.Length; i++)
                {
                    <div class="col-auto">
                        <img class="img-thumbnail product-thumbnail"
                             src="@imageArray[i]"
                             style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;"
                             onclick="changeMainImage('@imageArray[i]')"
                             alt="Product image @(i+1)">
                    </div>
                }
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <h4>@Model.Name</h4>
            <div class="d-flex align-items-center mt-3">
                <div class="me-2">
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star-fill text-warning"></i>
                    <i class="bi bi-star text-warning"></i>
                    <i class="bi bi-star text-warning"></i>
                </div>
                <span class="me-2">3.2</span>
                <span>(145 Değerlendirme)</span>
            </div>
            <div class="d-flex align-items-center">
                <h5 class="text-primary me-2" style="font-size: 1.25rem; font-weight: bold;">
                    @String.Format("{0:N2} ₺", @Model.GetDiscountedPrice())
                </h5>
                @if (Model.Discount > 0)
                {
                    <h6 class="text-decoration-line-through" style="font-size: 1rem; color: #888; margin-top: 0.25rem;">
                        @String.Format("{0:N2} ₺", @Model.Price)
                    </h6>
                }
            </div>
            <div class="mt-1 text-primary small">
                <span>Satıcı: </span>  @Model.ProductSeller.Username
            </div>
            <div class="mt-5">
                <h6 class="text-primary">Renk Seçenekleri</h6>
                <div class="d-flex">
                    <button class="btn btn-danger rounded-circle me-2 d-flex justify-content-center align-items-center"
                            style="width: 40px; height: 40px;">
                        <i class="bi bi-check"></i>
                    </button>
                    <button class="btn btn-primary rounded-circle me-2" style="width: 40px; height: 40px;"
                            disabled></button>
                    <button class="btn btn-success rounded-circle me-2" style="width: 40px; height: 40px;"></button>
                    <button class="btn btn-warning rounded-circle me-2" style="width: 40px; height: 40px;"></button>
                </div>
            </div>
            <div class="mt-4">
                <h6 class="text-primary">Boy Seçenekleri</h6>
                <div class="d-flex">
                    <button class="btn btn-primary me-2 d-flex justify-content-center align-items-center">S</button>
                    <button
                        class="btn btn-outline-primary me-2 d-flex justify-content-center align-items-center">M</button>
                    <button class="btn btn-outline-primary me-2 d-flex justify-content-center align-items-center"
                            disabled>L</button>
                </div>
            </div>
            <div class="d-flex align-items-center mt-5">
                <div class="d-flex align-items-center me-3">
                    <button class="btn btn-outline-secondary rounded-circle" onclick="remove()">
                        <i class="bi bi-dash"></i>
                    </button>
                    <input id="quantity-input" type="number" value="1" min="1" class="form-control mx-2"
                           style="width: 70px; text-align: center;">
                    <button class="btn btn-outline-secondary rounded-circle" onclick="add()">
                        <i class="bi bi-plus"></i>
                    </button>
                </div>
                <button class="btn btn-primary ms-auto" onclick="addToBasketWithQuantity()">Sepete Ekle</button>
            </div>
        </div>
    </div>

    <div class="row bg-light rounded p-4 mt-4">
        <div class="col-12">
            <ul class="nav nav-tabs" id="productTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active d-flex align-items-center" id="features-tab" data-bs-toggle="tab"
                        data-bs-target="#features" type="button" role="tab" aria-controls="features"
                        aria-selected="true">
                        <i class="bi bi-brush me-2"></i>
                        <span>Özellikler</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center" id="reviews-tab" data-bs-toggle="tab"
                        data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews"
                        aria-selected="false">
                        <i class="bi bi-star me-2"></i>
                        <span>Değerlendirmeler</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center" id="qa-tab" data-bs-toggle="tab"
                        data-bs-target="#qa" type="button" role="tab" aria-controls="qa" aria-selected="false">
                        <i class="bi bi-chat-dots me-2"></i>
                        <span>Soru Cevap</span>
                    </button>
                </li>
            </ul>

            <div class="tab-content p-4" id="productTabsContent">
                <div class="tab-pane fade show active" id="features" role="tabpanel" aria-labelledby="features-tab">
                    <p>
                        @Model.Description
                    </p>
                </div>

                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                    <div class="row">
                        <div class="col-12 col-lg-6 text-center">
                            <h2>3.2</h2>
                            <div>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star-fill text-warning"></i>
                                <i class="bi bi-star text-warning"></i>
                                <i class="bi bi-star text-warning"></i>
                            </div>
                            <h6 class="small">145 Değerlendirme</h6>
                        </div>
                        <div class="col-12 col-lg-6">
                            <div class="d-flex align-items-center mb-2">
                                <span class="me-2">5</span>
                                <i class="bi bi-star-fill text-warning me-2"></i>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="50"
                                        aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="ms-2">50%</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <span class="me-2">4</span>
                                <i class="bi bi-star-fill text-warning me-2"></i>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar" role="progressbar" style="width: 30%" aria-valuenow="30"
                                        aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="ms-2">30%</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <span class="me-2">3</span>
                                <i class="bi bi-star-fill text-warning me-2"></i>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar" role="progressbar" style="width: 5%" aria-valuenow="5"
                                        aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="ms-2">5%</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <span class="me-2">2</span>
                                <i class="bi bi-star-fill text-warning me-2"></i>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar" role="progressbar" style="width: 10%" aria-valuenow="10"
                                        aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="ms-2">10%</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <span class="me-2">1</span>
                                <i class="bi bi-star-fill text-warning me-2"></i>
                                <div class="progress flex-grow-1">
                                    <div class="progress-bar" role="progressbar" style="width: 15%" aria-valuenow="15"
                                        aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <span class="ms-2">15%</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="d-flex mb-2">
                            <img src="https://www.thispersondoesnotexist.com/" alt="" class="rounded-circle me-3"
                                style="width: 50px; height: 50px;">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>Mehmet Yılmaz</strong>
                                        <div class="text-muted small">17 Mart 2025</div>
                                    </div>
                                    <div>
                                        <span>4</span>
                                        <i class="bi bi-star-fill text-warning"></i>
                                    </div>
                                </div>
                                <p>
                                    Gerçekten harika bir ürün! Çini işlemeleri çok zarif ve kaliteli. Hem kullanışlı hem
                                    de dekoratif bir parça. Çay ve kahve içerken keyif veriyor. El yapımı olması da ayrı
                                    bir değer katıyor. Kesinlikle tavsiye ederim!
                                </p>
                            </div>
                        </div>
                        <hr>
                        <div class="d-flex">
                            <img src="https://www.thispersondoesnotexist.com/" alt="" class="rounded-circle me-3"
                                style="width: 50px; height: 50px;">
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>Ahmet Yılmaz</strong>
                                        <div class="text-muted small">12 Mart 2025</div>
                                    </div>
                                    <div>
                                        <span>1</span>
                                        <i class="bi bi-star-fill text-warning"></i>
                                    </div>
                                </div>
                                <p>
                                    Görsellerde çok şık duruyordu ama elime ulaşan kupa beklediğim gibi değildi.
                                    İşlemeleri soluk ve kalitesizdi. Ayrıca seramik oldukça ince, kırılmaya çok müsait.
                                    Fiyatına göre daha iyi bir kalite beklerdim.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="qa" role="tabpanel" aria-labelledby="qa-tab">
                    <div class="card-body">
                        <form id="question-form">
                            <div class="mb-3">
                                <label for="question" class="form-label fw-bold">Bir sorunuz mu var? Satıcıya
                                    sorun</label>
                                <textarea class="form-control" id="question" rows="2"
                                    placeholder="Sorunuzu Buraya Yazın..."></textarea>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div></div>
                                <button type="submit" class="btn btn-primary">Gönder</button>
                            </div>
                        </form>
                    </div>

                    <!-- Search Questions -->
                    <div class="card-body border-bottom bg-light mt-5">
                        <div class="input-group">
                            <span class="input-group-text bg-white border-end-0">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control border-start-0" placeholder="Sorularda Ara...">
                            <button class="btn btn-outline-secondary" type="button">Ara</button>
                        </div>
                    </div>

                    <!-- Q&A List -->
                    <div class="list-group list-group-flush">

                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between mb-1">
                                <h6 class="mb-0">
                                    <i class="bi bi-question-circle text-primary me-2"></i>
                                    Üzerindeki desenler zamanla silinir mi?
                                </h6>
                                <small class="text-muted">1 saat önce soruldu</small>
                            </div>
                            <p class="small text-muted mb-0">F. S. Tarafından Soruldu</p>
                            <div class="mt-2">
                                <span class="badge bg-warning text-dark">
                                    <i class="bi bi-clock me-1"></i> Cevap Bekleniyor
                                </span>
                            </div>
                        </div>

                        <!-- Question 1 -->
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between mb-1">
                                <h6 class="mb-0">
                                    <i class="bi bi-question-circle text-primary me-2"></i>
                                    Bu kupa bulaşık makinesinde yıkanabilir mi?
                                </h6>
                                <small class="text-muted">2 gün önce soruldu</small>
                            </div>
                            <p class="small text-muted mb-0">M. D. Tarafından Soruldu</p>

                            <!-- Answer -->
                            <div class="border-start border-3 border-success ps-3 mt-3">
                                <div class="d-flex w-100 justify-content-between mb-1">
                                    <h6 class="mb-0">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        Merhaba! Çini işlemeli kupamız elde yıkamaya daha uygundur. Bulaşık makinesinde
                                        yüksek sıcaklık ve deterjanlar zamanla
                                        desenlerin solmasına neden olabilir. Uzun ömürlü kullanım için elde yıkamanızı
                                        tavsiye ederiz.
                                    </h6>
                                </div>
                            </div>
                        </div>

                        <!-- Question 2 -->
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between mb-1">
                                <h6 class="mb-0">
                                    <i class="bi bi-question-circle text-primary me-2"></i>
                                    Ürün tamamen el yapımı mı?
                                </h6>
                                <small class="text-muted">5 gün önce soruldu</small>
                            </div>
                            <p class="small text-muted mb-0">S. M. Tarafından Soruldu</p>

                            <!-- Answer -->
                            <div class="border-start border-3 border-success ps-3 mt-3">
                                <div class="d-flex w-100 justify-content-between mb-1">
                                    <h6 class="mb-0">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        Evet, kupamız tamamen el yapımıdır. Çini desenleri usta zanaatkarlar tarafından
                                        tek tek işlenmektedir, bu nedenle her
                                        ürün kendine özgü küçük farklılıklar içerebilir.
                                    </h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .discount-badge-overflowed {
        position: absolute;
        top: 30px;
        left: -10px;
        background-color: var(--bs-primary);
        color: #fff;
        padding: 5px 15px;
        font-weight: bold;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        z-index: 1;
        width: auto;
        /* Fix for 100% width issue */
        display: inline-block;
        /* Ensure it takes only needed width */
    }

    .discount-badge-overflowed::before {
        content: "";
        position: absolute;
        left: 0;
        bottom: -10px;
        border-top: 10px solid #0d6efd;
        border-left: 10px solid transparent;
        opacity: 0.8;
    }

    input[type="number"].form-control {
        -webkit-appearance: textfield;
        -moz-appearance: textfield;
        appearance: textfield;
    }

    input[type="number"].form-control::-webkit-inner-spin-button,
    input[type="number"].form-control::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
</style>

<script>
    const input = document.getElementById("quantity-input");

    function add() {
        input.value = parseInt(input.value || '1') + 1;
    }

    function remove() {
        input.value = Math.max(parseInt(input.value || '1') - 1, 1);
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Bootstrap tabs
        var tabElements = document.querySelectorAll('#productTabs button');
        tabElements.forEach(function (tabElement) {
            tabElement.addEventListener('click', function (event) {
                event.preventDefault();
                var tabId = this.getAttribute('data-bs-target');

                // Remove active class from all tabs and panes
                document.querySelectorAll('#productTabs button').forEach(function (tab) {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('#productTabsContent .tab-pane').forEach(function (pane) {
                    pane.classList.remove('show', 'active');
                });

                // Add active class to selected tab and pane
                this.classList.add('active');
                document.querySelector(tabId).classList.add('show', 'active');
            });
        });
    });

    function addToBasketWithQuantity() {
        const productId = '@Model.Id'
        const quantity = input.value;
        
        fetch('/Product/AddProductToBasketProductWithQuantity?productId=' + productId + '&quantity=' + quantity, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            return response.json();
        })
        .then(data => {
            loadBasketItems();
            showToast('Ürün Sepete Eklendi!', true);
        })
        .catch(error => {
            console.error('Error adding product to basket:', error);
            showToast('Bir Hata Oluştu.', false);
        });
    }

    function changeMainImage(imageSrc) {
        document.getElementById('mainImage').src = imageSrc;
    }
</script>